---

---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/rubri/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Rust Browser Interpreter</title>
	</head>
	<body>
		<div id="grid">
			<h1><span>Ru</span>st <span>Br</span>owser <span>I</span>nterpreter</h1>
			<div id="live-edit-wrapper">
				<input id="live-edit" type="checkbox" checked />
				<label for="live-edit">Live Edit</label>
			</div>
			<textarea id="input" spellcheck="false" />
			<button>RUN</button>
			<textarea id="output" readonly spellcheck="false" />
		</div>
	</body>
</html>

<style>
	body {
		height: 100vh;
		font-family: 'Courier New', Courier, monospace;
		margin: 0;
		padding: 0;
	}
	#grid {
		height: calc(100% - 1rem);
		margin-left: 1rem;
		margin-right: 1rem;
		display: grid;
		grid-template-rows: min-content min-content 1fr 5rem 1fr;
		gap: .5rem;
	}
	button {
		font-family: inherit;
		font-weight: 700;
		font-size: x-large;
	}
	textarea {
		font-size: x-large;
	}
	textarea#input {
		resize: none;
	}
	textarea#output {
		resize: none;
	}
	#live-edit, #live-edit-wrapper {
		user-select: none;
	}
	span {
		text-decoration: underline;
	}
</style>

<script>
	import { Interpreter } from "../interpreter";

	const input = document.body.querySelector<HTMLTextAreaElement>("textarea#input")!;
	const output = document.body.querySelector<HTMLTextAreaElement>("textarea#output")!;
	const button = document.body.querySelector<HTMLButtonElement>("button")!;
	const liveEdit = document.body.querySelector<HTMLInputElement>("#live-edit")!;
	
	input.value = "Loading...";
	input.placeholder = "Write your code...";
	input.readOnly = true;
	const interpreter = new Interpreter();
	interpreter.onLoaded(() => {
		input.readOnly = false;
		input.value = 'println!("Hello Rubri!");';
	});
	interpreter.onRun(() => {
		output.value = "Running...";
		button.disabled = true;
	})
	interpreter.onResult(result => {
		output.value = result;
		button.disabled = false;
	})
	
	input.addEventListener("input", async () => {
		if (!liveEdit.checked) {
			return;
		}
		console.log(input.value);
		interpreter.run(input.value || "");
	});
	button.addEventListener("click", async () => {
		console.log(input.value);
		interpreter.run(input.value || "");
	})

</script>